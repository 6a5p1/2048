!function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(i){function n(){!t&&this.initialize&&this.initialize.apply(this,arguments)}var r=this.prototype;t=!0;var s=new this;t=!1;for(var o in i)s[o]="function"==typeof i[o]&&"function"==typeof r[o]&&e.test(i[o])?function(t,e){return function(){var i=this._super;this._super=r[t];var n=e.apply(this,arguments);return this._super=i,n}}(o,i[o]):i[o];return n.prototype=s,n.prototype.constructor=n,n.extend=arguments.callee,n}}();var UT=UT||{};UT.template=function(){var t={},e=function i(e,n){var r=/\W/.test(e)?Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');"):t[e]=t[e]||i(document.querySelector(e).innerHTML);return n?r(n):r};return e}();var UT=UT||{};!function(t){t.q=function(t,e){return(e||document).querySelector(t)},t.qq=function(t,e){return(e||document).querySelectorAll(t)},t.isArray=function(t){return Array.isArray(t)},t.isElement=function(t){return t instanceof HTMLElement},t.matchesSelector=Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||function(e){return-1!==[].indexOf.call(t.qq(e),this)},t.matches=function(e,i){return e&&e!==document?t.matchesSelector.call(e,i):!1},t.element=function(e){return"string"==typeof e?t.q(e):e},t.extend=function(){for(var t,e={},i=0,n=arguments.length;n>i;i++)for(t in arguments[i])arguments[i].hasOwnProperty(t)&&(e[t]=arguments[i][t]);return e},t.getProbability=function(t){return Math.floor(100*Math.random())<t},t.arraysEqual=function(t,e){return JSON.stringify(t)==JSON.stringify(e)},t.cloneDeep=function(t){return JSON.parse(JSON.stringify(t))};var e=["swipeleft","swiperight","swipedown","swipeup"];t.on=function(i,n,r,s,o,a){if(Array.isArray(n))return n.forEach(function(e){t.on(i,e,r,s,o,a)});if(-1!==e.indexOf(n)&&!i.has_swipe_active){var u,c,h,l,p=10,f=function(t){return"screenX"in t?t.screenX:t.touches[0].screenX},m=function(t){return"screenY"in t?t.screenY:t.touches[0].screenY},v=function(t){t.preventDefault(),u=f(t),c=m(t)},d=function(t){t.preventDefault(),h=f(t),l=m(t)},g=function(){var e=h-u,n=l-c,s=Math.abs(e)-Math.abs(n)>0?e:n;Math.abs(s)>p&&(s===e?t.trigger(t.q(r,i),"swipe"+(0>e?"left":"right")):s===n&&t.trigger(t.q(r,i),"swipe"+(0>n?"up":"down")))};i.has_swipe_active=!0,t.on(i,["mousedown","touchstart"],r,v),t.on(i,["mousemove","touchmove"],r,d),t.on(i,["mouseup","touchend"],r,g)}i.addEventListener(n,function(e){var n=e.target;if(!r)return s.call(o||n,e,i);for(;n;){if(t.matches(n,r))return s.call(o||n,e,n);n=n.parentNode}},!!a)},t.trigger=function(t,e,i){var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!0),n.data=i,t.dispatchEvent(n)}}(UT);var UT=UT||{};UT.Event=Class.extend({el:document.createElement("div"),initialize:function(){this.el=document.createElement("div")},init:function(){},trigger:function(t,e){return UT.trigger(this.el,t,e)},on:function(t,e,i){"function"!=typeof i&&(i=e,e=this),UT.on(e.el,t,"string"==typeof e?e:"",i,this)}});var UT=UT||{};UT.View=UT.Event.extend({initialize:function(){this._super.call(this),"object"==typeof arguments[0]&&null!==arguments[0]&&(arguments[0].el&&(this.el=arguments[0].el),arguments[0].collection&&(this.collection=arguments[0].collection),arguments[0].model&&(this.model=arguments[0].model),this.options=arguments[0]);for(var t in this.events){var e=t.split(/\s+/),i=e[0].trim(),n=(e[1]||"").trim(),r="function"==typeof this.events[t]?this.events[t]:this[this.events[t]];UT.on(this.el,i,n,r,this)}this.init.apply(this,arguments)},events:{},q:function(t){return UT.q(t,this.el)},qq:function(t){return UT.qq(t,this.el)},destroy:function(){var t=this.el.cloneNode(!0);this.el.parentNode&&this.el.parentNode.replaceChild(t,this.el),this.el.innerHTML=""}}),UT.Games=UT.Games||{},UT.Games[2048]=function(){"use strict";var t={LEFT:37,UP:38,RIGHT:39,DOWN:40},e="g2o48_";return UT.View.extend({init:function(t){return this.o=UT.extend(this.defaults,t||{}),this.el?(this.el.setAttribute("tabindex","1"),this.el.style.outline="none",this.el.focus(),this.createHtml(),this.start(),this):alert("Please specify a valid container")},defaults:{size:4},events:{click:function(){this.el.focus()},keydown:"onKeyPress","click      .g2o48_new-game":"start","click      .g2o48_undo":"undo","click      .g2o48_auto":"doAuto","swipeleft  .g2o48_game":function(){this.do("left")},"swiperight .g2o48_game":function(){this.do("right")},"swipedown  .g2o48_game":function(){this.do("down")},"swipeup    .g2o48_game":function(){this.do("up")}},changeGridSize:function(t){2>t||t>6||(this.o.size=t||4,this.createHtml(),this.start())},onKeyPress:function(e){e.preventDefault(),e.stopPropagation(),e.keyCode===t.LEFT?this.do("left"):e.keyCode===t.RIGHT?this.do("right"):e.keyCode===t.UP?this.do("up"):e.keyCode===t.DOWN&&this.do("down")},clearInterval:function(){clearInterval(this._interval),this._interval=null},start:function(){this.clearInterval();var t,e;for(this.matrix=[],this.historyArray=[],this.scoreArray=[],this.score=0,this.move=0,t=0;t<this.o.size;t++)for(this.matrix[t]=Array(this.o.size),e=0;e<this.o.size;e++)this.matrix[t][e]=0;this.addNumber(),this.addNumber(),this.pushIntoHistory(),this.refreshTable()},pushIntoHistory:function(){this.historyArray[this.move]=UT.cloneDeep(this.matrix),this.scoreArray[this.move]=this.score,this.move++},afterMove:function(t,e){if(t===!0){var i=this.addNumber();this.pushIntoHistory(),this.refreshTable(i,e),this.testForAvailableMoves()}},areMovesAvailable:function(){var t,e;for(t=0;t<this.o.size;t++)for(e=0;e<this.o.size;e++){if(0===this.matrix[t][e])return!0;if(e<this.o.size-1&&this.matrix[t][e]===this.matrix[t][e+1])return!0;if(t<this.o.size-1&&this.matrix[t][e]===this.matrix[t+1][e])return!0}return!1},testForAvailableMoves:function(){this.areMovesAvailable()||setTimeout(function(){alert("Game over! Your score is: "+this.score)}.bind(this),100)},isEmptySquare:function(){var t,e;for(t=0;t<this.o.size;t++)for(e=0;e<this.o.size;e++)if(0===this.matrix[t][e])return!0;return!1},addNumber:function(){if(!this.isEmptySquare())return{};var t,e,i;do t=Math.floor(Math.random()*this.o.size),e=Math.floor(Math.random()*this.o.size),i=UT.getProbability(90)?2:4;while(0!==this.matrix[t][e]);return this.matrix[t][e]=i,{x:t,y:e}},swapMatrixCells:function(t,e,i,n){var r=this.matrix[t][e];this.matrix[t][e]=this.matrix[i][n],this.matrix[i][n]=r},removeBlanks:function(t,e){var i,n,r=!1;if("right"===e){for(i=0;i<this.o.size;i++)if(0===this.matrix[t][i])for(n=i;n>=1;n--)r=r||this.matrix[t][n]!==this.matrix[t][n-1],this.swapMatrixCells(t,n,t,n-1)}else if("left"===e){for(i=this.o.size-1;i>=0;i--)if(0===this.matrix[t][i])for(n=i;n<this.o.size-1;n++)r=r||this.matrix[t][n]!==this.matrix[t][n+1],this.swapMatrixCells(t,n,t,n+1)}else if("up"===e){for(i=this.o.size-1;i>=0;i--)if(0===this.matrix[i][t])for(n=i;n<this.o.size-1;n++)r=r||this.matrix[n][t]!==this.matrix[n+1][t],this.swapMatrixCells(n,t,n+1,t)}else if("down"===e)for(i=0;i<this.o.size;i++)if(0===this.matrix[i][t])for(n=i;n>=1;n--)r=r||this.matrix[n][t]!==this.matrix[n-1][t],this.swapMatrixCells(n,t,n-1,t);return r},doAuto:function(){return this._interval?this.clearInterval():void(this._interval=setInterval(function(){var t=this.getBestMove();return t?this.do(t):void this.clearInterval()}.bind(this),100))},getBestMove:function(){var t,e,i=UT.cloneDeep(this.matrix),n=-1;return this.do("right",!0)&&(e=this.getScore(),e>n&&(n=e,t="right")),this.matrix=UT.cloneDeep(i),this.do("down",!0)&&(e=this.getScore(),e>n&&(n=e,t="down")),this.matrix=UT.cloneDeep(i),this.do("left",!0)&&(e=this.getScore(),e>n&&(n=e,t="left")),this.matrix=UT.cloneDeep(i),this.do("up",!0)&&(e=this.getScore(),e>n&&(n=e,t="up")),this.matrix=UT.cloneDeep(i),t},getScore:function(){var t,e,i,n=0,r=0,s=0,o=0,a=0,u={down:0,left:0,up:0,right:0},c={topLeft:0,bottomRight:0,topRight:0,bottomLeft:0};for(e=0;e<this.o.size;e++)for(i=0;i<this.o.size;i++)o<this.matrix[e][i]&&(o=this.matrix[e][i]),n+=!(0!==this.matrix[e][i]),e<this.o.size-1&&(u.up+=!(this.matrix[e][i]<=this.matrix[e+1][i]),u.down+=!(this.matrix[e][i]>=this.matrix[e+1][i]),a+=!(this.matrix[e][i]!==this.matrix[e+1][i])),i<this.o.size-1&&(u.left+=!(this.matrix[e][i]<=this.matrix[e][i+1]),u.right+=!(this.matrix[e][i]>=this.matrix[e][i+1]),a+=!(this.matrix[e][i]!==this.matrix[e][i+1])),e<this.o.size-1&&i<this.o.size-1&&(c.topLeft=c.topLeft&&this.matrix[e][i]>=this.matrix[e][i+1]&&this.matrix[e][i]>=this.matrix[e+1][i],c.bottomRight=c.bottomRight&&this.matrix[e][i]<=this.matrix[e][i+1]&&this.matrix[e][i]<=this.matrix[e+1][i],c.topRight=c.topRight&&this.matrix[e][i]<=this.matrix[e][i+1]&&this.matrix[e][i]>=this.matrix[e+1][i],c.bottomLeft=c.bottomLeft&&this.matrix[e][i]>=this.matrix[e][i+1]&&this.matrix[e][i]<=this.matrix[e+1][i]);for(t in u)u[t]>r&&(r=u[t]);var h=!1;for(t in c)c[t]>s&&(s=c[t]),h=h||c[t];return o*(n+a)},"do":function(t,e){for(var i,n=UT.cloneDeep(this.matrix),r=0;r<this.o.size;r++){if(this.removeBlanks(r,t),"right"===t)for(i=this.o.size-1;i>=1;i--)this.matrix[r][i]===this.matrix[r][i-1]&&this.matrix[r][i]&&(this.matrix[r][i]=this.matrix[r][i]+this.matrix[r][i-1],this.score+=this.matrix[r][i],this.matrix[r][i-1]=0);else if("left"===t)for(i=0;i<this.o.size-1;i++)this.matrix[r][i]===this.matrix[r][i+1]&&this.matrix[r][i]&&(this.matrix[r][i]=this.matrix[r][i]+this.matrix[r][i+1],this.score+=this.matrix[r][i],this.matrix[r][i+1]=0);else if("up"===t)for(i=0;i<this.o.size-1;i++)this.matrix[i][r]===this.matrix[i+1][r]&&this.matrix[i][r]&&(this.matrix[i][r]=this.matrix[i][r]+this.matrix[i+1][r],this.score+=this.matrix[i][r],this.matrix[i+1][r]=0);else if("down"===t)for(i=this.o.size-1;i>=1;i--)this.matrix[i][r]===this.matrix[i-1][r]&&this.matrix[i][r]&&(this.matrix[i][r]=this.matrix[i][r]+this.matrix[i-1][r],this.score+=this.matrix[i][r],this.matrix[i-1][r]=0);this.removeBlanks(r,t)}var s=!UT.arraysEqual(this.matrix,n);return e!==!0&&this.afterMove(s,t),s},createHtml:function(){this.el.innerHTML=UT.template('<div class="<%= prefix %>header <%= prefix %>wrapper"><div class="<%= prefix %>1_3"><div class="<%= prefix %>line"><button class="<%= prefix %>new-game <%= prefix %>btn">New game</button></div><div class="<%= prefix %>line"><button class="<%= prefix %>undo <%= prefix %>btn">Undo</button></div><div class="<%= prefix %>line"><button class="<%= prefix %>auto <%= prefix %>btn">Auto</button></div></div><div class="<%= prefix %>1_3"><h1 class="<%= prefix %>title">2048</h1><div class="<%= prefix %>subtitle">by 6a5p1</div></div><div class="<%= prefix %>1_3"><div class="<%= prefix %>line"><div class="<%= prefix %>score-wr <%= prefix %>btn">Score: <div class="<%= prefix %>score"></div></div></div><div class="<%= prefix %>line"><div class="<%= prefix %>moves-wr <%= prefix %>btn">Moves: <span class="<%= prefix %>moves"></span></div></div></div></div><div class="<%= prefix %>game <%= prefix %>wrapper <%= prefix %>game_'+this.o.size+'"></div>',{prefix:e}),this.els={grid:this.q("."+e+"game"),score:this.q("."+e+"score"),moves:this.q("."+e+"moves")},this.els.grid.style.fontSize=224/this.o.size+"px"},refreshTable:function(t,i){var n,r,s,o,a="";for(i=i?e+i:"",n=0;n<this.o.size;n++)for(r=0;r<this.o.size;r++)s="",t&&n===t.x&&r===t.y?s+=UT.template(" <%= prefix %>appear ",{prefix:e}):this.move>1&&this.matrix[n][r]&&this.matrix[n][r]!=this.historyArray[this.move-2][n][r]&&(s+=i+" "),o=this.matrix[n][r]||"",s+=UT.template("<%= prefix %>field <%= prefix %>num<%= value %>",{prefix:e,value:o}),a+='<div class="'+s+'">'+o+"</div>";this.els.grid.innerHTML=a,this.els.score.innerHTML=this.score,this.els.moves.innerHTML=this.move-1},undo:function(){this.move-1>0&&(this.move--,this.matrix=UT.cloneDeep(this.historyArray[this.move-1]),this.score=this.scoreArray[this.move-1],this.refreshTable())}})}();